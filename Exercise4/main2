puts 'Enter directory path: '
path = gets.strip
Dir.chdir path


files = Dir.glob '*T.xml'

if files.length == 0
  puts 'No files found'
  exit
end

def start(numberOfTabs, lines)
  lineNumber = 1
  $file.syswrite("<class>\n")


  #writes the keyword class
  $file.syswrite('  '*(numberOfTabs+1) + "#{lines[lineNumber]}")
  lineNumber = lineNumber + 1


  #writes the class name
  $file.syswrite('  '*(numberOfTabs+1) +"#{lines[lineNumber]}")
  lineNumber = lineNumber + 1

  #writes the symbol '{'
  $file.syswrite('  '*(numberOfTabs+1) +"#{lines[lineNumber]}")
  lineNumber = lineNumber + 1

  #calling to classVarDec*
  while (lines[lineNumber][(lines[lineNumber].index('>')+1)..(lines[lineNumber].index('</')-1)] ==' static ' ||lines[lineNumber][(lines[lineNumber].index('>')+1)..(lines[lineNumber].index('</')-1)]==' field ')
    puts 'classVarDec'
    lineNumber = classVarDec numberOfTabs+1, lineNumber, lines
  end

  #calling to subroutineDec*
  while (lines[lineNumber][lines[lineNumber].index('>')+1..lines[lineNumber].index('</')-1]==' constructor ' ||lines[lineNumber][lines[lineNumber].index('>')+1..lines[lineNumber].index('</')-1]==' function '||lines[lineNumber][lines[lineNumber].index('>')+1..lines[lineNumber].index('</')-1]==' method ')
    lineNumber = subroutineDec numberOfTabs+1, lineNumber, lines
  end

  #writes the symbol '}'
  $file.syswrite('  '*(numberOfTabs+1) +"#{lines[lineNumber]}")
  lineNumber = lineNumber + 1

  #closing
  $file.syswrite("</class>\n")
end


#need to implement
def subroutineDec (numberOfTabs, lineNumber, lines)
  #opening
  $file.syswrite('  '*numberOfTabs + "<subroutineDec>\n")

  #writes the 'constructor'|'function'|'method'
  $file.syswrite('  '*(numberOfTabs+1) +"#{lines[lineNumber]}")
  lineNumber = lineNumber + 1

  #write return type
  $file.syswrite('  '*(numberOfTabs+1) +"#{lines[lineNumber]}")
  lineNumber = lineNumber + 1

  #write name
  $file.syswrite('  '*(numberOfTabs+1) +"#{lines[lineNumber]}")
  lineNumber = lineNumber + 1

  #write '('
  $file.syswrite('  '*(numberOfTabs+1) +"#{lines[lineNumber]}")
  lineNumber = lineNumber + 1

  lineNumber = parameterList numberOfTabs , lineNumber , lines
  $file.syswrite('  '*numberOfTabs + "</subroutineDec>\n")
  return lineNumber
end

def parameterList numberOfTabs , lineNumber , lines

end



=begin
def type numberOfTabs , lineNumber , lines

  #opening
  $file.syswrite('  '*numberOfTabs + "<type>\n")

  temp = lines[lineNumber][lines[lineNumber].index('>')+1..lines[lineNumber].index('</')-1]
  if [' int ',' char ' , ' boolean '].include? temp
    $file.syswrite('  '*(numberOfTabs+1) +"#{lines[lineNumber]}")
    lineNumber = lineNumber + 1
    else
  end


  #ending
  $file.syswrite('  '*numberOfTabs + "</type>\n")
end
=end


#need to implement
def classVarDec(numberOfTabs, lineNumber, lines)
  #opening
  $file.syswrite('  '*numberOfTabs + "<classVarDec>\n")

  #writing the static or field
  $file.syswrite('  '*(numberOfTabs + 1) + "#{lines[lineNumber]}")
  lineNumber = lineNumber + 1

  #writing the type
  $file.syswrite('  '*(numberOfTabs + 1) + "#{lines[lineNumber]}")
  lineNumber = lineNumber + 1

  #closing
  $file.syswrite('  '*numberOfTabs + "</classVarDec>\n")

  return lineNumber
end


for i in 0..files.length - 1 do

  $file_name=files[i][0..files[i].index('T.xml')-1]
  #puts $file_name
  $file = File.new("#{$file_name}1.xml", 'w')
  lines = File.readlines("#{$file_name}T.xml")
  start(0, lines)
  #lines.each do |line|
  #  analyzeLine(line)
  #end

end

